<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Message d'amour</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&display=swap');

  body {
    margin: 0;
    height: 100vh;
    overflow: hidden;
    font-family: 'Dancing Script', cursive;
    background: #1a1a2e;
    display: flex;
    justify-content: center;
    align-items: center;
    color: #fff;
  }

  canvas {
    position: absolute;
    top: 0;
    left: 0;
  }

  #message, #final-text {
    position: relative;
    z-index: 1;
    font-size: 3em;
    text-align: center;
    white-space: pre-wrap;
  }

  .heart {
    color: red;
    display: inline-block;
    transform-origin: center;
    cursor: pointer;
  }

  .pop {
    animation: pop 0.3s ease forwards;
  }

  @keyframes pop {
    0% { transform: scale(0.2); opacity: 0; }
    50% { transform: scale(1.5); opacity: 1; }
    100% { transform: scale(1); opacity: 1; }
  }

  .final-heart {
    font-size: 5em;
    color: red;
    cursor: pointer;
    display: inline-block;
    animation: bounce 0.6s infinite alternate;
  }

  @keyframes bounce {
    0% { transform: translateY(0); }
    100% { transform: translateY(-15px); }
  }

  .explosion-heart {
    position: absolute;
    font-size: 1.5em;
    color: red;
    animation: explode 1s forwards;
  }

  @keyframes explode {
    0% { transform: translate(0,0) scale(1); opacity: 1;}
    100% { transform: translate(var(--x), var(--y)) scale(0.5); opacity: 0;}
  }
</style>
</head>
<body>
<canvas id="stars"></canvas>
<div id="message"></div>
<div id="final-text"></div>

<script>
// === Fond étoilé ===
const canvas = document.getElementById("stars");
const ctx = canvas.getContext("2d");

function resizeCanvas() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
window.addEventListener("resize", resizeCanvas);
resizeCanvas();

const numStars = 200;
const stars = [];
for (let i = 0; i < numStars; i++) {
  stars.push({
    x: Math.random() * canvas.width,
    y: Math.random() * canvas.height,
    radius: Math.random() * 1.5 + 0.5,
    dx: (Math.random() - 0.5) * 0.2,
    dy: (Math.random() - 0.5) * 0.2,
    alpha: Math.random()
  });
}

function drawStars() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  stars.forEach(star => {
    ctx.beginPath();
    ctx.arc(star.x, star.y, star.radius, 0, Math.PI * 2);
    ctx.fillStyle = `rgba(255,255,255,${star.alpha})`;
    ctx.fill();

    star.x += star.dx;
    star.y += star.dy;
    if (star.x < 0) star.x = canvas.width;
    if (star.x > canvas.width) star.x = 0;
    if (star.y < 0) star.y = canvas.height;
    if (star.y > canvas.height) star.y = 0;

    star.alpha += (Math.random() - 0.5) * 0.02;
    if (star.alpha < 0) star.alpha = 0;
    if (star.alpha > 1) star.alpha = 1;
  });
  requestAnimationFrame(drawStars);
}
drawStars();

// === Texte avec animation ===
const messageEl = document.getElementById("message");
const finalTextEl = document.getElementById("final-text");
const message = "Courage mon rayon de soleil, fais de ton mieux, je t'aime\nI love you";
let index = 0;

function typeWriter() {
  if (index < message.length) {
    messageEl.innerHTML += message.charAt(index);
    index++;
    setTimeout(typeWriter, 50);
  } else {
    setTimeout(startPopAnimation, 500);
  }
}

// Animation fluide du "I love you"
function startPopAnimation() {
  const heartStages = ["I love you", "I ♥ you", "I ♥ U", "♥ U", "♥"];
  let currentStage = 0;

  function nextStage() {
    if (currentStage < heartStages.length) {
      messageEl.innerHTML = messageEl.innerHTML.split("\n")[0] + "\n" +
        `<span class="heart pop">${heartStages[currentStage]}</span>`;
      currentStage++;
      setTimeout(nextStage, 800);
    } else {
      const finalHeart = document.querySelector(".heart");
      finalHeart.classList.add("final-heart");
      finalHeart.addEventListener("click", heartExplosion);
    }
  }
  nextStage();
}

// Explosion de cœurs au clic + écriture du MOUA
function heartExplosion(e) {
  const finalHeart = e.currentTarget;
  messageEl.style.display = "none"; // supprime le texte précédent

  const num = 100;
  for (let i = 0; i < num; i++) {
    const h = document.createElement("div");
    h.className = "explosion-heart";
    h.innerText = "♥";
    document.body.appendChild(h);
    h.style.left = finalHeart.offsetLeft + finalHeart.offsetWidth/2 + "px";
    h.style.top = finalHeart.offsetTop + finalHeart.offsetHeight/2 + "px";
    const angle = Math.random() * 2 * Math.PI;
    const dist = 200 + Math.random() * 150;
    h.style.setProperty('--x', `${Math.cos(angle)*dist}px`);
    h.style.setProperty('--y', `${Math.sin(angle)*dist}px`);
    setTimeout(() => h.remove(), 1800);
  }
  finalHeart.remove();
  typeFinalText("MOUUUUUUUUAAAAAAAAAAAA gros bisou");
}

// Fonction pour écrire le texte final lettre par lettre
function typeFinalText(text) {
  finalTextEl.style.display = "block";
  let i = 0;
  function writeLetter() {
    if (i < text.length) {
      finalTextEl.innerHTML += text[i];
      i++;
      setTimeout(writeLetter, 80);
    }
  }
  writeLetter();
}

// Lancer l'animation
typeWriter();
</script>
</body>
</html>
